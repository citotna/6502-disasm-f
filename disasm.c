#include <stdio.h>
#include <stdint.h>

const char op_str   [][3]={"RRA","SEI","BIT","SBC","BVC","RTS","LXA","DEC","BVS","BCS","PLA","PLP","BEQ","LSR","ASR","SHA","PHA","ROL","LDY","ORA","STY","CLC","INY","CPX","RTI","TXS","BCC","EOR","AND","TSX","DEY","SHS","SBX","RLA","SEC","STA","ARR","CLV","JSR","SHX","BPL","NOP","SAX","TAY","ADC","LDX","PHP","ISC","TAX","STX","CMP","SED","TXA","XAA","LDA","ANC","DCP","ASL","BRK","SRE","DEX","JMP","TYA","CLD","CPY","INC","LAS","LAX","JAM","INX","SLO","BNE","CLI","ROR","SHY","BMI"};
const uint8_t op_idx[256]={58,19,68,70,41,19,57,70,46,19,57,55,41,19,57,70,40,19,68,70,41,19,57,70,21,19,41,70,41,19,57,70,38,28,68,33,2,28,17,33,11,28,17,55,2,28,17,33,75,28,68,33,41,28,17,33,34,28,41,33,41,28,17,33,24,27,68,59,41,27,13,59,16,27,13,14,61,27,13,59,4,27,68,59,41,27,13,59,72,27,41,59,41,27,13,59,5,44,68,0,41,44,73,0,10,44,73,36,61,44,73,0,8,44,68,0,41,44,73,0,1,44,41,0,41,44,73,0,41,35,41,42,20,35,49,42,30,41,52,53,20,35,49,42,26,35,68,15,20,35,49,42,62,35,25,31,74,35,39,15,18,54,45,67,18,54,45,67,43,54,48,6,18,54,45,67,9,54,68,67,18,54,45,67,37,54,29,66,18,54,45,67,64,50,41,56,64,50,7,56,22,50,60,32,64,50,7,56,71,50,68,56,41,50,7,56,63,50,41,56,41,50,7,56,23,3,41,47,23,3,65,47,69,3,41,3,23,3,65,47,12,3,68,47,41,3,65,47,51,3,41,47,41,3,65,47};
const uint8_t addr_m [256]={6,8,0,8,11,11,11,11,6,5,1,5,2,2,2,2,10,9,0,9,12,12,12,12,6,4,6,4,3,3,3,3,2,8,0,8,11,11,11,11,6,5,1,5,2,2,2,2,10,9,0,9,12,12,12,12,6,4,6,4,3,3,3,3,6,8,0,8,11,11,11,11,6,5,1,5,2,2,2,2,10,9,0,9,12,12,12,12,6,4,6,4,3,3,3,3,6,8,0,8,11,11,11,11,6,5,1,5,7,2,2,2,10,9,0,9,12,12,12,12,6,4,6,4,3,3,3,3,5,8,5,8,11,11,11,11,6,5,6,5,2,2,2,2,10,9,0,9,12,12,13,13,6,4,6,4,3,3,4,4,5,8,5,8,11,11,11,11,6,5,6,5,2,2,2,2,10,9,0,9,12,12,13,13,6,4,6,4,3,3,4,4,5,8,5,8,11,11,11,11,6,5,6,5,2,2,2,2,10,9,0,9,12,12,12,12,6,4,6,4,3,3,3,3,5,8,5,8,11,11,11,11,6,5,6,5,2,2,2,2,10,9,0,9,12,12,12,12,6,4,6,4,3,3,3,3};

void disasm(uint8_t *c,size_t l,uint16_t b) {
    for(uint8_t *e=c+l,*s=c; c<e; ++c) { 
        uint16_t d=b+c-s; 
		printf("%04X: %02X ",d,*c);
        switch((89491104>>(addr_m[*c]*2))&3) {
	    case 0: printf("        %.3s",op_str[op_idx[*c]]); break;
	    case 2: printf("%02X %02X   %.3s ",c[1],c[2],op_str[op_idx[*c]]);
	        switch(addr_m[*c]) {
				#define _P(_C,_S) case _C:printf(_S,c[2],c[1]);c+=2;break;
				_P(2,"$%02X%02X");   _P(3,"$%02X%02X,Y");
				_P(4,"$%02X%02X,X"); _P(7,"($%02X%02X)");
				#undef _P
			} break;
	    case 1: printf("%02X      %.3s ",c[1],op_str[op_idx[*c]]); 
	        switch(addr_m[*c]) { 
				#define _P(_C,_S) case _C:printf(_S,c[1]);c+=1;break;
				case 10: printf("$%04X",(uint16_t)(d+(int8_t)c[1])+2); c++; break;
    		    _P(8,"($%02X,X)");   _P(9,"($%02X),Y");
				_P(5,"#$%02X");      _P(11,"$%02X");
				_P(12,"$%02X,X");    _P(13,"$%02X,Y"); 
				#undef _P
			} break;
		} putchar('\n');
    } return;
}
